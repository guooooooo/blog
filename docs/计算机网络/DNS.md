---
title: DNS
date: 2019-08-27
tags:
 - 计算机网络
categories:
 - 计算机网络
---

## DNS概要

### 域名结构

![gUynFj.png](https://t1.picb.cc/uploads/2019/10/10/gUynFj.png)

### DNS服务器

**DNS是Domain Name Service的缩写。DNS服务器是进行域名和与之对应的IP地址转换的服务器**

![gUycYe.jpg](https://t1.picb.cc/uploads/2019/10/10/gUycYe.jpg)

- 根DNS服务器：返回顶级域DNS服务器的IP地址
- 顶级域DNS服务器：返回权威DNS服务器的IP地址
- 权威DNS服务器：返回相应主机对应的IP地址



### 浏览器如何向DNS服务器发出查询

1. 浏览器搜索自身的DNS缓存。看缓存有没有过期，过期的话缓存的解析就结束了（chrome缓存的时间只有一分钟）
2. 搜索操作系统自身的DNS缓存。如果浏览器没有找到缓存或者缓存过期失效，浏览器就会搜索操作系统自身的缓存，没有找到或者失效，解析结束（操作系统的缓存：window系统是一天，mac系统严格根据DNS协议中的TTL）
3. 读取本地的hosts文件。如果操作系统的缓存也没有找到或者失效，浏览器就会读取本地的hosts文件（hosts文件也可以建立域名到IP地址的绑定关系，可以通过编辑hosts文件来达到名称解析的目的）
4. 浏览器发起一个DNS的系统调用。hosts中没有找到对应的配置项的话，浏览器发起一个DNS的调用（向本地主控DNS服务，一般说是运营商提供）

### DNS解析流程

1. 客户端会向本地域名服务器（本地DNS）发送DNS请求，我要访问www.163.com，请告诉我它的IP地址
2. 本地DNS收到客户端的请求，会先在本地缓存表中查找，有就直接返回。没有的话，本地DNS会向根域名服务器发出请求（根域名服务器是最高层次的，全球共13套，不直接用于域名解析，但能指明道路）
3. 根DNS收到来自本地DNS的请求，发现后缀是.com，则会告诉本地DNS（.com）对应的顶级域名服务器的地址
4. 本地DNS转向顶级域名服务器进行查询。顶级域名服务器就是比如.com,.net,.org这些一级域名，它负责管理二级域名。比如163.com
5. 顶级域名服务器收到请求后则会返回负责www.163.com区域的权威DNS服务器的地址。
6. 本地DNS转向问权威DNS服务器，163.com的权威DNS服务器是域名解析结果的原出处。
7. 权威DNS服务器查询后将对应的IP地址x.x.x.x告诉本地DNS
8. 本地DNS再将IP地址返回客户端，客户端和目标建立连接

![gUy1ls.jpg](https://t1.picb.cc/uploads/2019/10/10/gUy1ls.jpg)
